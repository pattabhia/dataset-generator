# dataset_generator/sections/company_kb.py

from __future__ import annotations

from typing import Any, Dict, List

from .base import SectionBuilder


class CompanyKBTrainingBuilder(SectionBuilder):
    """Section 11 (positive): Company Knowledge Base factual Q&A."""

    @property
    def file_name(self) -> str:
        return "company_kb_training.json"

    def build_examples(self) -> List[Dict[str, Any]]:
        cfg = self.config
        n = 120
        examples: List[Dict[str, Any]] = []

        for idx in range(1, n + 1):
            system = (
                f"You are {cfg.agent_name}, answer using only {cfg.kb_label}."
            )
            instruction = (
                f"Company KB question {idx}: detail {idx} about {cfg.company_name}."
            )
            output = (
                f"{cfg.company_name} detail {idx}: autogenerated placeholder fact for "
                f"training in the {cfg.domain_name} domain."
            )
            examples.append({
                "system": system,
                "instruction": instruction,
                "input": "",
                "output": output,
            })

        return examples


class CompanyKBNoHallucinationsTrainingBuilder(SectionBuilder):
    """Section 11 (negative): Refuse outside-KB questions."""

    @property
    def file_name(self) -> str:
        return "company_kb_no_hallucinations_training.json"

    def build_examples(self) -> List[Dict[str, Any]]:
        cfg = self.config
        n = 80
        examples: List[Dict[str, Any]] = []

        for idx in range(1, n + 1):
            system = (
                f"You are {cfg.agent_name}. If user asks outside {cfg.kb_label}, refuse safely."
            )
            instruction = f"Negative KB test {idx}: hallucination prevention."
            output = (
                "I donâ€™t have information about this outside the indexed knowledge base. "
                "Please provide relevant documents or context from the KB."
            )
            examples.append({
                "system": system,
                "instruction": instruction,
                "input": "",
                "output": output,
            })

        return examples
  